name: Code Quality

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Checking the formatting of the code
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  code-style:
    name: Check Code Style
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      # Checking .editorconfig
      - name: EditorConfig Checker
        uses: editorconfig-checker/action-editorconfig-checker@main
        with:
          version: latest

      # Checking trailing whitespaces
      - name: ðŸ§¹ Check Trailing Whitespace
        run: |
          if grep -r '[[:blank:]]$' --include="*.cs" Assets/Scripts/; then
            echo "âŒ Found trailing whitespace in C# files"
            exit 1
          else
            echo "âœ… No trailing whitespace found"
          fi

      # Checking the length of strings
      - name: Check Line Length
        run: |
          MAX_LENGTH=120
          LONG_LINES=$(find Assets/Scripts -name "*.cs" -exec awk -v max=$MAX_LENGTH 'length > max {print FILENAME":"NR": Line too long ("length" chars)"; errors++} END {exit errors}' {} +)
          if [ $? -ne 0 ]; then
            echo "âŒ Found lines longer than $MAX_LENGTH characters:"
            echo "$LONG_LINES"
            exit 1
          else
            echo "âœ… All lines within $MAX_LENGTH characters"
          fi

      # Checking TODO comments
      - name: Count TODOs
        run: |
          TODO_COUNT=$(grep -r "TODO" Assets/Scripts --include="*.cs" | wc -l || echo "0")
          echo "## ðŸ“ Technical Debt Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**TODO comments found:** $TODO_COUNT" >> $GITHUB_STEP_SUMMARY
          
          if [ "$TODO_COUNT" -gt 20 ]; then
            echo "âš ï¸ **Warning:** High number of TODOs. Consider addressing some." >> $GITHUB_STEP_SUMMARY
          elif [ "$TODO_COUNT" -eq 0 ]; then
            echo "âœ… **Excellent:** No TODO comments!" >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… Technical debt under control" >> $GITHUB_STEP_SUMMARY
          fi

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Code Complexity Analysis
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  complexity:
    name: Code Complexity
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      # Checking cyclomatic complexity
      - name: Check Method Complexity
        run: |
          echo "## ðŸ§® Code Complexity Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # ÐŸÑ€Ð¾ÑÑ‚Ð°Ñ ÑÐ²Ñ€Ð¸ÑÑ‚Ð¸ÐºÐ°: ÑÑ‡Ð¸Ñ‚Ð°ÐµÐ¼ if/for/while Ð² Ð¼ÐµÑ‚Ð¾Ð´Ð°Ñ…
          # Ð’ Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ lizard Ð¸Ð»Ð¸ Ð¿Ð¾Ð´Ð¾Ð±Ð½Ñ‹Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ñ‹
          
          COMPLEX_METHODS=$(find Assets/Scripts -name "*.cs" -exec grep -l "if.*if.*if.*if" {} \; | wc -l)
          
          echo "**Methods with high complexity:** $COMPLEX_METHODS" >> $GITHUB_STEP_SUMMARY
          
          if [ "$COMPLEX_METHODS" -gt 5 ]; then
            echo "âš ï¸ Consider refactoring complex methods" >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… Code complexity looks good" >> $GITHUB_STEP_SUMMARY
          fi

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # Naming verification
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  naming:
    name: Naming Conventions
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Check Naming Conventions
        run: |
          echo "## ðŸ·ï¸ Naming Convention Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÐµÐ¹ Ñ underscore
          NO_UNDERSCORE=$(grep -rn "private.*\s[a-z][a-zA-Z]*;" Assets/Scripts --include="*.cs" | grep -v "_" || true)
          
          if [ -n "$NO_UNDERSCORE" ]; then
            echo "âš ï¸ **Found private fields without underscore prefix:**" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "$NO_UNDERSCORE" | head -10 >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… All private fields follow naming convention" >> $GITHUB_STEP_SUMMARY
          fi

          # Checking PascalCase for public methods
          LOWERCASE_METHODS=$(grep -rn "public.*\s[a-z][a-zA-Z]*(" Assets/Scripts --include="*.cs" || true)
          
          if [ -n "$LOWERCASE_METHODS" ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ **Found public methods not in PascalCase:**" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "$LOWERCASE_METHODS" | head -10 >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… All public methods follow PascalCase" >> $GITHUB_STEP_SUMMARY
          fi